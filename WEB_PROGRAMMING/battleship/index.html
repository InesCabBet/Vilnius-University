<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Battleship Game</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <h1>Battleship</h1>
        
        <div id="message" class="message">Click on the computer's board to attack!</div>
        
        <div class="boards-container">
            <div class="board-wrapper">
                <h2>Your Board</h2>
                <div id="player-board" class="board"></div>
            </div>
            
            <div class="board-wrapper">
                <h2>Computer's Board</h2>
                <div id="computer-board" class="board"></div>
            </div>
        </div>
        
        <button id="reset-btn" class="btn">New Game</button>
    </div>

    <div id="game-over-modal" class="modal">
        <div class="modal-content">
            <h2 id="modal-message"></h2>
            <button id="play-again-btn" class="btn">Play Again</button>
        </div>
    </div>

    <script type="module">
        import { Game } from './src/game.js';
        import { DOMController } from './src/dom.js';

        let game = new Game();
        game.setupGame();

        const playerBoardEl = document.getElementById('player-board');
        const computerBoardEl = document.getElementById('computer-board');
        const resetBtn = document.getElementById('reset-btn');
        const playAgainBtn = document.getElementById('play-again-btn');

        function renderBoards() {
            DOMController.renderBoard(game.player.gameboard, playerBoardEl, true);
            DOMController.renderBoard(game.computer.gameboard, computerBoardEl, false);
        }

        function handleComputerBoardClick(e) {
            if (!e.target.classList.contains('cell') || game.gameOver) return;
            
            const x = parseInt(e.target.dataset.x);
            const y = parseInt(e.target.dataset.y);

            const result = game.playerAttack(x, y);
            
            if (result === null) {
                DOMController.showMessage('Invalid move! Try another cell.');
                return;
            }

            renderBoards();

            if (result.gameOver) {
                DOMController.showGameOver(result.winner);
                return;
            }

            DOMController.showMessage(result.hit ? 'Hit!' : 'Miss!');

            setTimeout(() => {
                const computerResult = game.computerAttack();
                renderBoards();

                if (computerResult && computerResult.gameOver) {
                    DOMController.showGameOver(computerResult.winner);
                    return;
                }

                DOMController.showMessage(
                    computerResult && computerResult.hit 
                        ? 'Computer hit your ship!' 
                        : 'Computer missed!'
                );

                setTimeout(() => {
                    DOMController.showMessage('Your turn! Click on the computer\'s board to attack.');
                }, 1000);
            }, 1000);
        }

        function resetGame() {
            game.reset();
            renderBoards();
            DOMController.hideGameOver();
            DOMController.showMessage('Click on the computer\'s board to attack!');
        }

        computerBoardEl.addEventListener('click', handleComputerBoardClick);
        resetBtn.addEventListener('click', resetGame);
        playAgainBtn.addEventListener('click', resetGame);

        renderBoards();
    </script>
</body>
</html>